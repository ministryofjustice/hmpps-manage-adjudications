{% extends "../partials/layout.njk" %}

{% from "../partials/breadCrumb.njk" import breadcrumb %}
{% from "govuk/components/table/macro.njk" import govukTable %}

{% set title = "Select a report" %}

{% block pageTitle %}
  {{ title }}
{% endblock %}

{% block beforeContent %}
  {{ breadcrumb() }}
{% endblock %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-three-quarters">
      <h1 class="govuk-heading-l">{{ title }}</h1>

      {% set rows = [] %}
      {% for report in reports %}
        {% set prisonerLinkHtml %}
        <a href="{{ digitalPrisonServiceUrl }}/prisoner/{{ report.prisonerNumber }}" class="govuk-link">{{ report.displayName }} - {{report.prisonerNumber}} </a>
        {% endset -%}
        {% set discoveryDateTimeHtml %}
        <p class="govuk-body continue-report-text" data-qa="incident-date-text">{{ report.formattedDiscoveryDateTime }}</p>
        {% endset -%}
        {% set continueReportLinkHtml %}
        <a href="{{ adjudicationUrls.taskList.urls.start(report.id) }}" class="govuk-link" data-qa="continue-report-link-{{report.id}}">Continue<span class="govuk-visually-hidden">for {{ report.friendlyName }}</span></a>
        {% endset -%}
        {% set rows = (rows.push([
      {
        html: prisonerLinkHtml,
        attributes: {
          "data-sort-value": report.displayName
        }
      },
      { html: discoveryDateTimeHtml, attributes: {
          "data-sort-value": report.incidentDetails.dateTimeOfIncident
        } },
      { html: continueReportLinkHtml }
    ]), rows) %}
      {% endfor %}

      {% if rows | length %}
        <div class="results-table">
          {{ govukTable({
        head: [
          {
            text: "Name and prison number",
            attributes: {
              "aria-sort": "ascending",
              "data-qa": "prisoner-name-sort"
            }
          },
          { text: "Discovery date and time", 
            attributes: {
              "aria-sort": "ascending",
              "data-qa": "date-sort"

            }
           },
          { text: "" }
        ],
        rows: rows,
        attributes: { "data-qa": "continue-report-results-table", "data-module": "moj-sortable-table" }
      }) }}
        </div>
      </div>
    </div>

  {% else %}
    {% if not errors | length %}
      <p class="govuk-!-padding-top-3" data-qa="no-results-message">There are no reports for you to continue.</p>
    {% endif %}
  {% endif %}

{% endblock %}