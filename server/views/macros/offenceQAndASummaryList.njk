{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}

{% macro offenceQAndASummaryList(offence, isYouthOffender, attributes = {}, classes='', cardTitle = null, cardActionPresent = false, cardActionHref = null, cardActionDataQa = null, cardActionText = "Change") %}
  {% set rows = [] %}

    {# Add YOI rule to table rows #}
    {% if isYouthOffender %}
        {% set ruleValue = { html:
            '<p>YOI offences</p><p>' + true | prisonRule + '</p>'
        } %}
    {% else %}
        {% set ruleValue = { html:
            '<p>Adult offences</p><p>' + false | prisonRule + '</p>'
        } %}
    {% endif %}

    {% set rows = (rows.push(
        {
            key: {
                text: 'Which set of rules apply to the prisoner?'
            },
            value: ruleValue
        }
    ), rows) %}

    {# Add questions and answers to table rows #}
    {% for questionAndAnswer in offence.questionsAndAnswers %}
        {% set value = {text: questionAndAnswer.answer} %}
        {% set rows = (rows.push(
        {
            key: {
                text: questionAndAnswer.question
            },
            value: value
        }
        ), rows) %}
    {% endfor %}

    {# Add final row - the paragraph numbers #}
    {% if offence.incidentRule %}
        {% set offencesValue = { html:
            '<p>' + isYouthOffender | prisonRule + ', paragraph ' + offence.incidentRule.paragraphNumber + '</p>' +
            '<p>' + offence.incidentRule.paragraphDescription + '</p>' +
            '<p>' + isYouthOffender | prisonRule + ', paragraph ' + offence.offenceRule.paragraphNumber + '</p>' +
            '<p>' + offence.offenceRule.paragraphDescription + '</p>'
        } %}
    {% else %}
        {% set offencesValue = { html:
            '<p>' + isYouthOffender | prisonRule + ', paragraph ' + offence.offenceRule.paragraphNumber + '</p>' +
            '<p>' + offence.offenceRule.paragraphDescription + '</p>'
        } %}
     {% endif %}
    {% set rows = (rows.push(
        {
            key: {
                text: 'This offence broke'
            },
            value: offencesValue
        }
    ), rows) %}

  {% if cardActionPresent %}
    {% set cardActionItems = [
      {
        href: cardActionHref,
        text: cardActionText,
        visuallyHiddenText: cardTitle,
        attributes: cardActionDataQa
      }
    ] %}
  {% else %}
    {% set cardActionItems = [] %}
  {% endif %}

  {% set cardDetails = {
    title: {
      text: cardTitle
    },
    actions: {
      items: cardActionItems
    }
  } %}

  {% if rows.length %}
    {% if cardTitle %}
      {{ govukSummaryList({
      card: cardDetails,
      rows: rows,
      classes: classes,
      attributes: attributes
    }) }}
    {% else %}
      {{ govukSummaryList({
      rows: rows,
      classes: classes,
      attributes: attributes
    }) }}
    {% endif %}
    {% endif %}

{% endmacro %}