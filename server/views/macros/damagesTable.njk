{% from "govuk/components/table/macro.njk" import govukTable %}

{% macro damagesTable(damages, redirectAfterRemoveUrl, currentUser) %}
  {% set rows = [] %}
  <div class="flex-container govuk-!-margin-top-5">
    {% for damage in damages %}
    {% set damageIndex = loop.index %}

    {% if damage.reporter == currentUser %}
      {% set removeColumnValue = '<p class="govuk-body govuk-!-margin-bottom-1"><a href="'+redirectAfterRemoveUrl+damageIndex+'" data-qa="delete-'+damageIndex+'" class="govuk-link">Remove</a></p>' %}
    {% else %}
      {% set removeColumnValue = '' %}
    {% endif %}

    {% set rows = (rows.push(
        [
            {
                text: damage.type | damageCode
            }, 
            {
                text: damage.description
            },
            {
                html: removeColumnValue
            }
        ]
    ), rows) %}
    {% endfor %}

    {% if rows.length %}
            {{ govukTable({
  head: [
    {
      text: "Type of repair needed"
    },
    {
      text: "Description of damage"
    },
    {
        text: null 
    }
  ],
  rows: rows,
  attributes: {"data-qa": "damages-table"}
}) }}
    {% endif %}
{% endmacro %}