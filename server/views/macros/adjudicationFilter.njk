{% from "../macros/datePicker.njk" import datePicker %}
{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/select/macro.njk" import govukSelect %}
{% from "govuk/components/checkboxes/macro.njk" import govukCheckboxes %}

{% macro adjudicationFilter(filter, statuses, errors, clearUrl, csrfToken) %}
  {% set allFiltersStr = filter.status.toString() %}
  {% set filterValuesArray = allFiltersStr.split(',') %}
  {% set items = [] %}
  {% for status in statuses %}
    {% set item = {text:status.text, value:status.value, checked: false } %}
    {% for filterValue in filterValuesArray %}
      {% if filterValue === item.value %}
        {% set item = {text:item.text, value:item.value, checked: true } %}
      {% endif%}
    {% endfor %}
    {% if status.value !== 'ACCEPTED' %}
      {% set items = (items.push(item),items) %}
    {% endif%}
  {% endfor %}

    <form class="horizontal-form-container" method="POST" novalidate="novalidate" data-qa="completed-reports-form">
        <h2 class="govuk-heading-m">Date of discovery</h2>
        <input type="hidden" name="_csrf" value="{{ csrfToken }}" />
        {% set fromDateError = errors | findErrors(['fromDate[date]']) %}
        <div {% if fromDateError %}class="govuk-form-group--error"{% endif %} data-qa='filter-bar'>
            {% if fromDateError %}
            <p id="fromDate[date]-error" class="govuk-error-message">
                <span class="govuk-visually-hidden">Error:</span>{{ fromDateError.text }}
            </p>
            {% endif %}
            <div class="displayFlex" id="adjudicationFilter">
                {{ datePicker({
                    id: 'fromDate[date]',
                    label: 'Date from',
                    name: 'fromDate[date]',
                    date: filter.fromDate,
                    attributes: {'data-disable-future-date':'true', 'data-qa': "from-date" },
                    classes: 'govuk-input--width-10' + (' govuk-input--error' if fromDateError else '')
                }) }}

                <div class="spacerCol"></div>

                {{ datePicker({
                    id: 'toDate[date]',
                    label: 'Date to',
                    name: 'toDate[date]',
                    date: filter.toDate,
                    attributes: {'data-disable-future-date':'true', 'data-qa': "to-date" },
                    classes: 'govuk-input--width-10'
                }) }}

                <div class="spacerCol"></div>
                <div class="spacerCol"></div>

              <div id="statusFilterBox">
                {{ govukCheckboxes({
                  name: "status",
                  classes: "govuk-checkboxes--small stausFilterCheckboxes",
                  fieldset: {
                    legend: {
                      text: "Status",
                      isPageHeading: false,
                      classes: "govuk-fieldset__legend--m"
                    }
                  },
                  items: items
                }) }}
              </div>
            </div>
            <div class="horizontal-form govuk-!-margin-bottom-3">
                {{ govukButton({
                    text: "Apply",
                    type: "submit",
                    classes: "govuk-button--submit",
                    attributes: { "data-qa": "filter-apply" }
                }) }}
                <p class="govuk-body adj-filter-clear-link"><a class='govuk-link' href='{{ clearUrl }}' data-qa='clear-filter'>Clear</a></p>
            </div>
        </div>
    </form>
{% endmacro %}